<!DOCTYPE html>
<html>

    <head>
        <!-- Basic Page Info -->
        <meta charset="utf-8">
        <title>My Profile</title>
        <link rel="apple-touch-icon" sizes="180x180" href="images/icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="images/icon.png">
        <link rel="icon" type="image/png" sizes="16x16" href="images/icon.png">

        <!-- Mobile Specific Metas -->
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <!-- Google Font -->
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
            rel="stylesheet">
        <!-- CSS -->
        <link rel="stylesheet" type="text/css" href="vendors/styles/core.css">
        <link rel="stylesheet" type="text/css" href="vendors/styles/icon-font.min.css">
        <link rel="stylesheet" type="text/css" href="src/plugins/cropperjs/dist/cropper.css">
        <link rel="stylesheet" type="text/css" href="vendors/styles/style.css">
        <link rel="stylesheet" type="text/css" href="src/plugins/jquery-steps/jquery.steps.css">
        <link rel="stylesheet" type="text/css" href="src/plugins/dropzone/src/dropzone.css">


        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-119386393-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());

            gtag('config', 'UA-119386393-1');
        </script>
    </head>

    <body>
        <!-- <div class="pre-loader">
		<div class="pre-loader-box">
			<div class="loader-logo"><img src="vendors/images/deskapp-logo.svg" alt=""></div>
			<div class='loader-progress' id="progress_div">
				<div class='bar' id='bar1'></div>
			</div>
			<div class='percent' id='percent1'>0%</div>
			<div class="loading-text">
				Loading...
			</div>
		</div>
	</div> -->

        <div class="header">
            <div class="header-left">
                <div class="menu-icon dw dw-menu"></div>
                <div class="search-toggle-icon dw dw-search2" data-toggle="header_search"></div>
            </div>
            <div class="header-right">
                <div class="dashboard-setting user-notification">
                    <div class="dropdown">
                        <a class="dropdown-toggle no-arrow" href="javascript:;" data-toggle="right-sidebar">
                            <i class="dw dw-settings2"></i>
                        </a>
                    </div>
                </div>
                <div class="user-notification">
                    <div class="dropdown">
                        <a class="dropdown-toggle no-arrow" href="#" role="button" data-toggle="dropdown">
                            <i class="icon-copy dw dw-notification"></i>
                            <span class="badge notification-active"></span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right">
                            <div class="notification-list mx-h-350 customscroll">
                                <ul>
                                    <li>
                                        <a href="#">
                                            <img src="vendors/images/img.jpg" alt="">
                                            <h3>John Doe</h3>
                                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed...</p>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#">
                                            <img src="vendors/images/photo1.jpg" alt="">
                                            <h3>Lea R. Frith</h3>
                                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed...</p>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#">
                                            <img src="vendors/images/photo2.jpg" alt="">
                                            <h3>Erik L. Richards</h3>
                                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed...</p>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#">
                                            <img src="vendors/images/photo3.jpg" alt="">
                                            <h3>John Doe</h3>
                                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed...</p>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#">
                                            <img src="vendors/images/photo4.jpg" alt="">
                                            <h3>Renee I. Hansen</h3>
                                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed...</p>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#">
                                            <img src="vendors/images/img.jpg" alt="">
                                            <h3>Vicki M. Coleman</h3>
                                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed...</p>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="user-info-dropdown">
                    <div class="dropdown">
                        <a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown">
                            <span class="user-icon">
                                <img src="vendors/images/photo1.jpg" alt="">
                            </span>
                            <span class="user-name">Welcome back <span id="userName"></span></span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right dropdown-menu-icon-list">
                            <a class="dropdown-item" href="profile.html"><i class="dw dw-user1"></i> Profile</a>
                            <a class="dropdown-item" href="profile.html"><i class="dw dw-settings2"></i> Setting</a>
<div class="dropdown-menu dropdown-menu-right dropdown-menu-icon-list">
    <a class="dropdown-item" href="profile.html"><i class="dw dw-user1"></i> Profile</a>
    <a class="dropdown-item" href="javascript:void(0);" onclick="logout();"><i class="dw dw-logout"></i> Log Out</a>
</div>                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div class="right-sidebar">
            <div class="sidebar-title">
                <h3 class="weight-600 font-16 text-blue">
                    Layout Settings
                    <span class="btn-block font-weight-400 font-12">User Interface Settings</span>
                </h3>
                <div class="close-sidebar" data-toggle="right-sidebar-close">
                    <i class="icon-copy ion-close-round"></i>
                </div>
            </div>
            <div class="right-sidebar-body customscroll">
                <div class="right-sidebar-body-content">
                    <h4 class="weight-600 font-18 pb-10">Header Background</h4>
                    <div class="sidebar-btn-group pb-30 mb-10">
                        <a href="javascript:void(0);" class="btn btn-outline-primary header-white active">White</a>
                        <a href="javascript:void(0);" class="btn btn-outline-primary header-dark">Dark</a>
                    </div>

                    <h4 class="weight-600 font-18 pb-10">Sidebar Background</h4>
                    <div class="sidebar-btn-group pb-30 mb-10">
                        <a href="javascript:void(0);" class="btn btn-outline-primary sidebar-light ">White</a>
                        <a href="javascript:void(0);" class="btn btn-outline-primary sidebar-dark active">Dark</a>
                    </div>

                    <h4 class="weight-600 font-18 pb-10">Menu Dropdown Icon</h4>
                    <div class="sidebar-radio-group pb-10 mb-10">
                        <div class="custom-control custom-radio custom-control-inline">
                            <input type="radio" id="sidebaricon-1" name="menu-dropdown-icon"
                                class="custom-control-input" value="icon-style-1" checked="">
                            <label class="custom-control-label" for="sidebaricon-1"><i
                                    class="fa fa-angle-down"></i></label>
                        </div>
                        <div class="custom-control custom-radio custom-control-inline">
                            <input type="radio" id="sidebaricon-2" name="menu-dropdown-icon"
                                class="custom-control-input" value="icon-style-2">
                            <label class="custom-control-label" for="sidebaricon-2"><i
                                    class="ion-plus-round"></i></label>
                        </div>
                        <div class="custom-control custom-radio custom-control-inline">
                            <input type="radio" id="sidebaricon-3" name="menu-dropdown-icon"
                                class="custom-control-input" value="icon-style-3">
                            <label class="custom-control-label" for="sidebaricon-3"><i
                                    class="fa fa-angle-double-right"></i></label>
                        </div>
                    </div>

                    <h4 class="weight-600 font-18 pb-10">Menu List Icon</h4>
                    <div class="sidebar-radio-group pb-30 mb-10">
                        <div class="custom-control custom-radio custom-control-inline">
                            <input type="radio" id="sidebariconlist-1" name="menu-list-icon"
                                class="custom-control-input" value="icon-list-style-1" checked="">
                            <label class="custom-control-label" for="sidebariconlist-1"><i
                                    class="ion-minus-round"></i></label>
                        </div>
                        <div class="custom-control custom-radio custom-control-inline">
                            <input type="radio" id="sidebariconlist-2" name="menu-list-icon"
                                class="custom-control-input" value="icon-list-style-2">
                            <label class="custom-control-label" for="sidebariconlist-2"><i class="fa fa-circle-o"
                                    aria-hidden="true"></i></label>
                        </div>
                        <div class="custom-control custom-radio custom-control-inline">
                            <input type="radio" id="sidebariconlist-3" name="menu-list-icon"
                                class="custom-control-input" value="icon-list-style-3">
                            <label class="custom-control-label" for="sidebariconlist-3"><i
                                    class="dw dw-check"></i></label>
                        </div>
                        <div class="custom-control custom-radio custom-control-inline">
                            <input type="radio" id="sidebariconlist-4" name="menu-list-icon"
                                class="custom-control-input" value="icon-list-style-4" checked="">
                            <label class="custom-control-label" for="sidebariconlist-4"><i
                                    class="icon-copy dw dw-next-2"></i></label>
                        </div>
                        <div class="custom-control custom-radio custom-control-inline">
                            <input type="radio" id="sidebariconlist-5" name="menu-list-icon"
                                class="custom-control-input" value="icon-list-style-5">
                            <label class="custom-control-label" for="sidebariconlist-5"><i
                                    class="dw dw-fast-forward-1"></i></label>
                        </div>
                        <div class="custom-control custom-radio custom-control-inline">
                            <input type="radio" id="sidebariconlist-6" name="menu-list-icon"
                                class="custom-control-input" value="icon-list-style-6">
                            <label class="custom-control-label" for="sidebariconlist-6"><i
                                    class="dw dw-next"></i></label>
                        </div>
                    </div>

                    <div class="reset-options pt-30 text-center">
                        <button class="btn btn-danger" id="reset-settings">Reset Settings</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="left-side-bar">
            <div class="brand-logo">
                <a href="index.html">
                    <img src="images/logo.png" alt="" class="dark-logo">
                    <img src="images/logo-night.png" alt="" class="light-logo">
                </a>
                <div class="close-sidebar" data-toggle="left-sidebar-close">
                    <i class="ion-close-round"></i>
                </div>
            </div>
            <div class="menu-block customscroll">
                <div class="sidebar-menu">
                    <ul id="accordion-menu">
                        <li>
                            <a href="shop.html" class="dropdown-toggle no-arrow shop-link">
                                <span class="micon dw dw-shop"></span><span class="mtext1">Shop</span>
                            </a>
                        </li>
                        <li>
                            <a href="profile.html" class="dropdown-toggle no-arrow shop-link">
                                <span class="micon dw dw-user"></span><span class="mtext1">Profile</span>
                            </a>
                        </li>

                        <!-- <li>
        							<a href="#" class="dropdown-toggle no-arrow" data-section="my-collection">
        								<span class="micon fa fa-bank"></span><span class="mtext">My Collection</span>
        							</a>
        						</li> -->
                        <!-- <li>
        							<a href="invoice.html" class="dropdown-toggle no-arrow">
        								<span class="micon fi-book-bookmark"></span><span class="mtext">Continue Reading</span>
        							</a>
        						</li> -->
                        <!-- <li>
        							<a href="invoice.html" class="dropdown-toggle no-arrow">
        								<span class="micon fa fa-bullhorn"></span><span class="mtext">New Releases</span>
        							</a>
        						</li> -->
                        <!-- <li>
        							<a href="invoice.html" class="dropdown-toggle no-arrow">
        								<span class="micon dw dw-shopping-cart1"></span><span class="mtext">Cart</span>
        							</a>
        						</li> -->
                        <!-- <li>
        							<a href="invoice.html" class="dropdown-toggle no-arrow">
        								<span class="micon fa fa-history"></span><span class="mtext">History</span>
        							</a>
        						</li> -->
                        <!-- <li>
        							<a href="invoice.html" class="dropdown-toggle no-arrow">
        								<span class="micon fa fa-heart"></span><span class="mtext">Favourite Author</span>
        							</a>
        						</li> -->
                        <li>
                            <a href="my-book.html" class="dropdown-toggle no-arrow my-book">
                                <span class="micon dw dw-books"></span><span class="mtext1">My Books</span>
                            </a>
                        </li>
                        <li>
                            <div class="dropdown-divider"></div>
                        </li>
                        <!-- <li>
        							<div class="sidebar-small-cap">Extra</div>
        						</li>
        						<li>
        							<a href="faq.html" target="_blank" class="dropdown-toggle no-arrow">
        								<span class="micon dw dw-paper-plane1"></span>
        								<span class="mtext">FAQs </span>
        							</a>
        						</li>
        						<li>
        							<a href="faq.html" target="_blank" class="dropdown-toggle no-arrow">
        								<span class="micon dw dw-paper-plane1"></span>
        								<span class="mtext">Feedback </span>
        							</a>
        						</li> -->
                    </ul>
                </div>
            </div>
        </div>
        <div class="mobile-menu-overlay"></div>

        <div class="main-container">
            <div class="pd-ltr-20 xs-pd-20-10">
                <div class="min-height-200px">
                    <div class="page-header">
                        <div class="row">
                            <div class="col-md-12 col-sm-12">
                                <div class="title">
                                    <h4 id="section-title">Profile</h4>
                                </div>
                                <nav aria-label="breadcrumb" role="navigation">
                                    <ol class="breadcrumb">
                                        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                                        <li class="breadcrumb-item active" aria-current="page" id="breadcrumb-section">
                                            Profile</li>
                                    </ol>
                                </nav>
                            </div>
                        </div>
                    </div>
                    <div id="my-books" class="section" style="display: block;">
                        <div class="tab">
                            <ul class="nav nav-tabs" role="tablist">
                                <li class="nav-item">
                                    <a id="books-tab" class="nav-link text-blue" data-toggle="tab" href="#books"
                                        role="tab" aria-selected="true">Books</a>
                                </li>
                                <li class="nav-item">
                                    <a id="upload-tab" class="nav-link text-blue" data-toggle="tab" href="#upload"
                                        role="tab" aria-selected="true">Upload Book</a>
                                </li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane fade show" id="books" role="tabpanel">
                                    <div class="pd-20">
                                        <div class="product-wrap">
                                            <div class="product-list">
                                                <ul class="row" id="book-list">
                                                    <!-- Book items will be dynamically loaded here -->
                                                </ul>
                                            </div>
                                            <!-- Pagination, can be hidden if not needed -->
                                            <div class="blog-pagination mb-30">
                                                <div class="btn-toolbar justify-content-center mb-15">
                                                    <div class="btn-group">
                                                        <a href="#" class="btn btn-outline-primary prev"><i
                                                                class="fa fa-angle-double-left"></i></a>
                                                        <a href="#" class="btn btn-outline-primary">1</a>
                                                        <a href="#" class="btn btn-outline-primary">2</a>
                                                        <span class="btn btn-primary current">3</span>
                                                        <a href="#" class="btn btn-outline-primary">4</a>
                                                        <a href="#" class="btn btn-outline-primary">5</a>
                                                        <a href="#" class="btn btn-outline-primary next"><i
                                                                class="fa fa-angle-double-right"></i></a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="upload" role="tabpanel">
                                    <div class="pd-20 card-box mb-30">
                                        <div class="clearfix">
                                            <h4 class="text-blue h4">Step Wizard for Book Upload</h4>
                                            <p class="mb-30">Multi-step form for uploading book details</p>
                                        </div>
                                        <div class="wizard-content pt-30">
                                            <form method="POST" enctype="multipart/form-data"
                                                class="tab-wizard wizard-circle wizard"
                                                action="http://127.0.0.1:8000/books/upload-book/">
                                                <!-- Step 1: Basic Details -->
                                                <h5>Basic Details</h5>
                                                <section>
                                                    <div class="form-group">
                                                        <label>Book Title:</label>
                                                        <input type="text" id="book-title" name="title"
                                                            class="form-control" required>
                                                    </div>
                                                    <div class="form-group">
                                                        <label>Author:</label>
                                                        <input type="text" id="author" name="author"
                                                            class="form-control" required>
                                                    </div>
                                                    <div class="form-group">
                                                        <label>Publish Date:</label>
                                                        <input type="text" id="publish-date" name="publish_date"
                                                            class="form-control date-picker" placeholder="Select Date"
                                                            required>
                                                    </div>
                                                    <div class="form-group">
                                                        <label>Publisher:</label>
                                                        <input type="text" id="publisher" name="publisher"
                                                            class="form-control" required>
                                                    </div>
                                                    <div class="form-group">
                                                        <label>Language:</label>
                                                        <input type="text" id="language" name="language"
                                                            class="form-control" required>
                                                    </div>
                                                    <div class="form-group">
                                                        <label>Pages:</label>
                                                        <input type="number" id="pages" name="pages"
                                                            class="form-control" required>
                                                    </div>
                                                    <div class="form-group">
                                                        <label>Published In:</label>
                                                        <input type="text" id="published-in" name="published_in"
                                                            class="form-control" required>
                                                    </div>
                                                    <div class="form-group">
                                                        <label>Series:</label>
                                                        <input type="text" id="series" name="series"
                                                            class="form-control">
                                                    </div>
                                                </section>

                                                <!-- Step 2: Genre and Description -->
                                                <h5>Genre & Description</h5>
                                                <section>
                                                    <div class="form-group">
                                                        <label>Select Genre</label>
                                                        <select id="genre" name="genre"
                                                            class="selectpicker form-control" data-size="5"
                                                            data-style="btn-outline-primary" multiple
                                                            data-actions-box="true" data-selected-text-format="count">
                                                            <optgroup label="Genres">
                                                                <option value="Action/Adventure fiction">
                                                                    Action/Adventure fiction</option>
                                                                <option value="Children’s fiction">Children’s
                                                                    fiction</option>
                                                                <option value="Classic fiction">Classic fiction
                                                                </option>
                                                                <option value="Contemporary fiction">
                                                                    Contemporary
                                                                    fiction</option>
                                                                <option value="Fantasy">Fantasy</option>
                                                                <option value="Graphic novel">Graphic novel
                                                                </option>
                                                                <option value="Historical fiction">Historical
                                                                    fiction</option>
                                                                <option value="Horror">Horror</option>
                                                                <option value="LGBTQ+">LGBTQ+</option>
                                                                <option value="Literary fiction">Literary
                                                                    fiction
                                                                </option>
                                                                <option value="Mystery">Mystery</option>
                                                                <option value="New adult">New adult</option>
                                                                <option value="Romance">Romance</option>
                                                                <option value="Satire">Satire</option>
                                                                <option value="Science fiction">Science fiction
                                                                </option>
                                                                <option value="Short story">Short story</option>
                                                                <option value="Thriller">Thriller</option>
                                                                <option value="Western">Western</option>
                                                                <option value="Women’s fiction">Women’s fiction
                                                                </option>
                                                                <option value="Young adult">Young adult</option>
                                                                <option value="Art & photography">Art &
                                                                    photography
                                                                </option>
                                                                <option value="Autobiography/Memoir">
                                                                    Autobiography/Memoir</option>
                                                                <option value="Biography">Biography</option>
                                                                <option value="Essays">Essays</option>
                                                                <option value="Food & drink">Food & drink
                                                                </option>
                                                                <option value="History">History</option>
                                                                <option value="How-To/Guides">How-To/Guides
                                                                </option>
                                                                <option value="Humanities & social sciences">
                                                                    Humanities & social sciences</option>
                                                                <option value="Humor">Humor</option>
                                                                <option value="Parenting">Parenting</option>
                                                                <option value="Philosophy">Philosophy</option>
                                                                <option value="Religion & spirituality">Religion
                                                                    &
                                                                    spirituality</option>
                                                                <option value="Science & technology">Science &
                                                                    technology</option>
                                                                <option value="Self-help">Self-help</option>
                                                                <option value="Travel">Travel</option>
                                                                <option value="True crime">True crime</option>
                                                            </optgroup>
                                                        </select>
                                                    </div>
                                                    <div class="form-group">
                                                        <label>Description:</label>
                                                        <textarea id="description" name="description"
                                                            class="form-control" rows="5" required></textarea>
                                                    </div>
                                                    <div class="form-group">
                                                        <label>Message from the Author:</label>
                                                        <textarea id="message-from-author" name="message_from_author"
                                                            class="form-control" rows="3"></textarea>
                                                    </div>
                                                </section>

                                                <!-- Step 3: Upload Files -->
                                                <h5>Upload Files</h5>
                                                <section>
                                                    <div class="form-group">
                                                        <label>Cost:</label>
                                                        <input type="text" id="cost" name="cost" class="form-control"
                                                            required>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-lg-6">
                                                            <div class="pd-20 card-box mb-30">
                                                                <div class="clearfix mb-20">
                                                                    <div class="pull-left">
                                                                        <h4 class="text-blue h4">Upload Image</h4>
                                                                    </div>
                                                                </div>
                                                                <input type="file" id="book-image" name="image"
                                                                    class="form-control" required>
                                                            </div>
                                                        </div>
                                                        <div class="col-lg-6">
                                                            <div class="pd-20 card-box mb-30">
                                                                <div class="clearfix mb-20">
                                                                    <div class="pull-left">
                                                                        <h4 class="text-blue h4">Upload Book PDF</h4>
                                                                    </div>
                                                                </div>
                                                                <input type="file" id="book-pdf" name="book_pdf"
                                                                    class="form-control" required>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label>Visibility:</label>
                                                        <select id="visibility" name="visibility" class="form-control"
                                                            required>
                                                            <option value="public">Public</option>
                                                            <option value="private">Private</option>
                                                        </select>
                                                    </div>
                                                </section>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                   <div class="modal fade" id="success-modal" tabindex="-1" role="dialog" aria-labelledby="success-modal-label" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center font-18">
                <h3 class="mb-20">Form Submitted!</h3>
                <div class="mb-30 text-center">
                    <img src="vendors/images/success.png" alt="Success">
                </div>
                <p>Book Uploaded Successfully</p>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Done</button>
            </div>
        </div>
    </div>
</div>

                </div>
            </div>

        </div>
        <!-- <div class="footer-wrap pd-20 mb-20 card-box">
					DeskApp - Bootstrap 4 Admin Template By <a href="https://github.com/dropways" target="_blank">Ankit
						Hingarajiya</a>
				</div> -->
        </div>
        </div>
        <!-- js -->
         
        <script src="vendors/scripts/core.js"></script>
        <script src="vendors/scripts/script.min.js"></script>
        <script src="vendors/scripts/process.js"></script>
        <script src="vendors/scripts/layout-settings.js"></script>
        <script src="src/plugins/cropperjs/dist/cropper.js"></script>
        <script src="src/plugins/jquery-steps/jquery.steps.js"></script>
        <script src="vendors/scripts/steps-setting.js"></script>
        <script src="src/plugins/dropzone/src/dropzone.js"></script>
        <!-- <script src="src/plugins/bootstrap-select/bootstrap-select.min.js.map"></script> -->
        <script>
            async function refreshTokenIfNeeded() {
                const accessToken = localStorage.getItem('access_token');
                const refreshToken = localStorage.getItem('refresh_token');

                if (!accessToken || !refreshToken) {
                    return;
                }

                const response = await fetch('http://127.0.0.1:8000/auth/jwt/refresh/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ refresh: refreshToken })
                });

                if (response.ok) {
                    const result = await response.json();
                    localStorage.setItem('access_token', result.access);
                    localStorage.setItem('refresh_token', result.refresh);
                } else {
                    localStorage.removeItem('access_token');
                    localStorage.removeItem('refresh_token');
                    alert('Session expired. Please log in again.');
                    window.location.href = '/login.html';
                }
            }


            // document.addEventListener("DOMContentLoaded", async function () {
            //     await refreshTokenIfNeeded();

            //     try {
            //         const response = await fetch('http://127.0.0.1:8000/auth/profile/', {
            //             method: 'GET',
            //             headers: {
            //                 'Authorization': `Bearer ${localStorage.getItem('access_token')}`
            //             }
            //         });

            //         if (response.ok) {
            //             const userData = await response.json();
            //             const userNameElem = document.getElementById('userFullName');
            //             const userEmailElem = document.getElementById('userEmail');
            //             const userPhoneElem = document.getElementById('userPhone');
            //             const userAddressElem = document.getElementById('userAddress');
            //             const userBioElem = document.getElementById('bioform');
            //             const userAgeElem = document.getElementById('userAge');
            //             const userTypeElem = document.getElementById('userType');
            //             const verificationStatusElem = document.getElementById('verification-status');
            //             const verifyButton = document.getElementById('verify-button'); // Use 'verify-button' id

            //             if (userNameElem && userEmailElem && userPhoneElem && userAddressElem && userBioElem && userAgeElem && userTypeElem) {
            //                 userNameElem.textContent = `${userData.first_name} ${userData.last_name}`;
            //                 userEmailElem.textContent = userData.email;
            //                 userPhoneElem.textContent = userData.phone_number;
            //                 userAddressElem.textContent = userData.address;
            //                 userBioElem.textContent = userData.bio;
            //                 userAgeElem.textContent = userData.age;
            //                 userTypeElem.textContent = userData.user_type;

            //                 if (userData.is_verified) {
            //                     verifyButton.style.display = 'none'; // Hide the verify button
            //                     verificationStatusElem.style.display = 'block'; // Show the verification status alert
            //                 }
            //             } else {
            //                 alert('Profile elements not found.');
            //             }
            //         } else {
            //             alert('Failed to load user profile.');
            //         }
            //     } catch (error) {
            //         alert('An error occurred while fetching the profile: ' + error.message);
            //     }
            // });

        </script>
        <!-- <script>
            document.addEventListener("DOMContentLoaded", async function () {
                await refreshTokenIfNeeded();

                try {
                    const response = await fetch('http://127.0.0.1:8000/auth/profile/', {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                        }
                    });

                    if (response.ok) {
                        const userData = await response.json();

                        // Populate form fields
                        document.getElementById('first_name').value = userData.first_name || '';
                        document.getElementById('last_name').value = userData.last_name || '';
                        document.getElementById('username').value = userData.username || '';
                        document.getElementById('email').value = userData.email || '';
                        document.getElementById('bioform').value = userData.bio || '';
                        document.getElementById('address').value = userData.address || '';
                        document.getElementById('birth_date').value = userData.birth_date || '';
                        document.getElementById('phone_number').value = userData.phone_number || '';

                        // Disable the username field to prevent editing
                        document.getElementById('username').disabled = true;

                    } else {
                        alert('Failed to load user profile.');
                    }
                } catch (error) {
                    alert('An error occurred while fetching the profile: ' + error.message);
                }
            });
            document.addEventListener("DOMContentLoaded", () => {
                const form = document.getElementById('profileForm');

                form.addEventListener('submit', async (event) => {
                    event.preventDefault(); // Prevent default form submission
                    const usernameInput = document.getElementById('username');
                    usernameInput.disabled = false;
                    // Gather form data
                    const formData = new FormData(form);
                    const data = {
                        first_name: formData.get('first_name') || '',
                        last_name: formData.get('last_name') || '',
                        username: formData.get('username') || '',
                        email: formData.get('email') || '',
                        bio: formData.get('bio') || '',
                        address: formData.get('address') || '',
                        birth_date: new Date(formData.get('birth_date')).toISOString().split('T')[0] || '',
                        phone_number: formData.get('phone_number') || '', // Add this if required
                        user_type: formData.get('user_type') || '' // Add this if required
                    };
                    usernameInput.disabled = true;
                    console.log('Form data:', data); // Debugging

                    try {
                        const response = await fetch('http://127.0.0.1:8000/auth/profile/', {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('access_token')}`
                            },
                            body: JSON.stringify(data)
                        });

                        if (response.ok) {
                            const result = await response.json();
                            alert('Profile updated successfully');
                            // Optionally, redirect or refresh the page
                        } else {
                            const error = await response.json();
                            console.error('Error response:', error);
                            alert('Failed to update profile: ' + (error.first_name ? error.first_name[0] : 'Unknown error'));
                        }
                    } catch (error) {
                        console.error('Fetch error:', error);
                        alert('An error occurred while updating the profile: ' + error.message);
                    }
                });
            });
        </script> -->


        <!-- 
		<script>
			document.addEventListener('DOMContentLoaded', () => {
				const requestOtpBtn = document.getElementById('request-otp-btn');
				const submitOtpBtn = document.getElementById('submit-otp-btn');
				const emailSection = document.getElementById('email-section');
				const otpSection = document.getElementById('otp-section');

				requestOtpBtn.addEventListener('click', async () => {
					await refreshTokenIfNeeded(); // Ensure the token is fresh

					const email = document.getElementById('email').value;
					if (!email) {
						alert('Please enter your email');
						return;
					}

					try {
						const response = await fetch('http://127.0.0.1:8000/otp/request-otp/', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json',
								'Authorization': `Bearer ${localStorage.getItem('access_token')}`
							},
							body: JSON.stringify({ email: email })
						});

						if (response.ok) {
							const data = await response.json();
							if (data.message) {
								emailSection.style.display = 'none';
								otpSection.style.display = 'block';
							} else {
								alert('Failed to request OTP');
							}
						} else {
							throw new Error('Network response was not ok.');
						}
					} catch (error) {
						console.error('Error:', error);
						alert('An error occurred while requesting OTP: ' + error.message);
					}
				});

				submitOtpBtn.addEventListener('click', async () => {
					await refreshTokenIfNeeded(); // Ensure the token is fresh

					const email = document.getElementById('email').value;
					const otp = document.getElementById('otp').value;
					if (!otp) {
						alert('Please enter the OTP');
						return;
					}

					try {
						const response = await fetch('http://127.0.0.1:8000/otp/verify-otp/', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json',
								'Authorization': `Bearer ${localStorage.getItem('access_token')}`
							},
							body: JSON.stringify({ email: email, otp_code: otp })
						});

						if (response.ok) {
							const data = await response.json();
							if (data.message) {
								$('#verification-modal').modal('hide');
								$('#success-modal').modal('show');
							} else {
								alert('Failed to verify OTP');
							}
						} else {
							throw new Error('Network response was not ok.');
						}
					} catch (error) {
						console.error('Error:', error);
						alert('An error occurred while verifying OTP: ' + error.message);
					}
				});
			});
		</script> -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const token = localStorage.getItem('access_token');

                if (!token) {
                    alert("User not authenticated.");
                    return;
                }

                // Function to fetch and display books
                function loadBooks() {
                    fetch('http://127.0.0.1:8000/books/user-books/', {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Failed to fetch books');
                            }
                            return response.json();
                        })
                        .then(data => {
                            const books = data.results;  // Access the books within the `results` array
                            if (books.length === 0) {
                                // No books uploaded yet, switch to "Upload Book" tab
                                alert('No books uploaded yet. You are now on the upload page.');
                                document.querySelector('#upload').classList.add('show', 'active');
                                document.querySelector('#books').classList.remove('show', 'active');
                                document.querySelector('#books-tab').classList.remove('active');
                                document.querySelector('#upload-tab').classList.add('active');
                            } else {
                                // Books are present, show the books tab
                                renderBooks(books);
                                 document.querySelector('#upload').classList.remove('show', 'active');
                                document.querySelector('#books').classList.add('show', 'active');
                                document.querySelector('#books-tab').classList.add('active');
                                document.querySelector('#upload-tab').classList.remove('active');
                            }
                        })
                        .catch(error => console.error('Error:', error));
                }

                // Immediately load books when the page loads
                loadBooks();

                // Function to render books
                function renderBooks(books) {
                    const bookContainer = document.querySelector('#books .product-list ul');
                    bookContainer.innerHTML = '';  // Clear existing content

                    books.forEach(book => {
                        const bookItem = `
                <li class="col-lg-4 col-md-6 col-sm-12">
                    <div class="product-box">
                        <div class="product-img"><img src="${book.image}" alt="${book.title}"></div>
                        <div class="product-caption">
                            <h4><a href="#">${book.title}</a></h4>
                            <div class="price"><ins>$${book.cost}</ins></div>
                            <a href="book-detail.html?book_id=${book.id}&source=local" class="btn btn-outline-primary">Read More</a>
                        </div>
                    </div>
                </li>
            `;
                        bookContainer.innerHTML += bookItem;
                    });
                }
            });

        </script>

        <script>
            function logout() {
                fetch('http://127.0.0.1:8000/auth/logout/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('access_token')}`, // or from cookies
                    },
                })
                    .then(response => {
                        if (response.ok) {
                            localStorage.removeItem('access_token'); // Clear the token from local storage
                            window.location.href = 'login.html'; // Redirect to login page
                        } else {
                            console.error('Logout failed');
                            alert('Logout failed. Please try again.');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred. Please try again.');
                    });
            }

        </script>

        <script>
            console.log($('#genre').val());

        </script>
    </body>

</html>
